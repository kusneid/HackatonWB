# üöÄ –•–∞–∫–∞—Ç–æ–Ω Wildberries

## üìä –ú–æ–¥–µ–ª—å
### **–û–ø–∏—Å–∞–Ω–∏–µ**  
–ü—Ä–æ–≥–Ω–æ–∑–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑–∞—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π.

### **–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**
```
- Pandas  # –ê–Ω–∞–ª–∏–∑ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- Scikit-learn  # –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- NumPy  # –í—ã—á–∏—Å–ª–µ–Ω–∏—è
- Matplotlib/Seaborn  # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
```

### –û–±–∑–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–¥—Ö–æ–¥
- **–î–∞—Ç–∞—Å–µ—Ç**  
  - –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: df_train.csv
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π: 105566  
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: 18  
- **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞**  
  - –ü—Ä–æ–ø—É—Å–∫–∏: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
  - –ü—Ä–∏–º–µ–Ω—è–ª–æ—Å—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    ```python
     scaler = StandardScaler()
     df_train[features] = scaler.fit_transform(df_train[features])
     df_test[features]  = scaler.transform(df_test[features])
     ```
  - –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞:  
    - SMOTE (`SMOTE(random_state=42)`)  
    - `class_weight='balanced'` –≤ LightGBM  
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏**  
  - –ê–ª–≥–æ—Ä–∏—Ç–º: LightGBM (–≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥ –Ω–∞ —Ä–µ—à–∞—é—â–∏—Ö –¥–µ—Ä–µ–≤–∞—Ö)  
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∞–Ω—Å–∞–º–±–ª–µ–≤—ã–π –ø–æ–¥—Ö–æ–¥ —Å –ø–æ–¥–±–æ—Ä–æ–º –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ grid search –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤—ã–±–æ—Ä–æ–º –ø–æ—Ä–æ–≥–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É F1-score –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏  

### –ö–ª—é—á–µ–≤—ã–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```python
best_params: {'n_estimators': 392, 'num_leaves': 63, 'max_depth': 10, 'learning_rate': 0.05, 'min_child_samples': 5, 'min_gain_to_split': 0.0, 'class_weight': 'balanced', 'random_state': 42, 'verbose': -1}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Ç–µ—Å—Ç–µ

- **–ü–æ—Ä–æ–≥ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Threshold):** 0.919  
- **Precision (–º–∏–Ω–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π –∫–ª–∞—Å—Å):** 0.879  
- **Recall (–º–∏–Ω–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π –∫–ª–∞—Å—Å):** 0.125  

#### Confusion Matrix
|               | Predicted 0 | Predicted 1 |
|---------------|-------------|-------------|
| **Actual 0**  |      12424  |      31     |
| **Actual 1**  |      1580   |     226     |

#### Classification Report
| –ö–ª–∞—Å—Å | Precision | Recall | F1-score | Support |
|-------|-----------|--------|----------|---------|
| 0     | 0.887     | 0.998  | 0.939    | 12455   |
| 1     | 0.879     | 0.125  | 0.219    | 1806    |
| **accuracy**    |           |        | **0.887**  | 14261   |
| **macro avg**   | 0.883     | 0.561  | 0.579    | 14261   |
| **weighted avg**| 0.886     | 0.887  | 0.848    | 14261   |

- **PR-AUC:** 0.367  
- **ROC-AUC:** 0.632  



## üñ•Ô∏è –ë—ç–∫–µ–Ω–¥
### **–û–ø–∏—Å–∞–Ω–∏–µ**  
REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –º–æ–¥–µ–ª—å—é –∏ –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

### **–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**  
```
- FastAPI  # –í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- Uvicorn  # ASGI-—Å–µ—Ä–≤–µ—Ä
- Pydantic  # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```

### **[üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](http://localhost:8000/docs)**

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
**`GET /model/test_connect`**  
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞

```http
GET /model/test_connect HTTP/1.1
Host: localhost:8000
```
#### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:

```json
{
  "status": "success",
  "message": "Service is available",
  "timestamp": "2023-08-20T12:34:56Z"
}
```
### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
**`PATCH /model/update_model`**

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ML-–º–æ–¥–µ–ª–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

#### ** file (binary): –§–∞–π–ª –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ —Ñ–æ—Ä–º–∞—Ç pkl (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) **

```http
PATCH /model/update_model HTTP/1.1
Content-Type: multipart/form-data
```
#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X PATCH -F "file=@new_model.pkl" http://localhost:8000/model/update_model
```
### 3. –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ CSV
**`POST /model/csv/predict`**

–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CSV-—Ñ–∞–π–ª–æ–≤

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–∞–π–ª—É:
- –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8
- –§–æ—Ä–º–∞—Ç: CSV —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è: —Å–º. –°—Ö–µ–º—É –¥–∞–Ω–Ω—ã—Ö

```http
POST /model/csv/predict HTTP/1.1
Content-Type: multipart/form-data
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
[
  {
    "prediction": true,
    "confidence": 0.95
  },
  {
    "prediction": false,
    "confidence": 0.23
  }
]
```
### 4. –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ JSON
**`POST /model/json/predict`**

–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:

```json
[
  {
    "user_id": 12345,
    "nm_id": 67890,
    "CreatedDate": "2023-08-20T12:00:00",
    ...
  }
]
```
#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X POST -H "Content-Type: application/json" \
  -d @request.json \
  http://localhost:8000/model/json/predict
```
### **üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**
### –ú–æ–¥–µ–ª—å Dataset
```json
{
  "user_id": "int (required)",
  "nm_id": "int (required)",
  "CreatedDate": "datetime (required)",
  "service": "string (required)",
  "total_ordered": "int (required)",
  "PaymentType": "string (required)",
  "IsPaid": "boolean (required)",
  "count_items": "int (required)",
  "unique_items": "int (required)",
  "avg_unique_purchase": "float (required)",
  "is_courier": "int (required)",
  "NmAge": "int (required)",
  "Distance": "int (required)",
  "DaysAfterRegistration": "int (required)",
  "number_of_orders": "int (required)",
  "number_of_ordered_items": "int (required)",
  "mean_number_of_ordered_items": "float (required)",
  "min_number_of_ordered_items": "int (required)",
  "max_number_of_ordered_items": "int (required)",
  "mean_percent_of_ordered_items": "float (required)"
}
```
### –ú–æ–¥–µ–ª—å Result
```json
{
  "prediction": "boolean (required)",
  "confidence": "float (required)"
}
```
### ‚ö†Ô∏è –û—à–∏–±–∫–∏
#### –ö–æ–¥—ã
- 200	OK	–£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- 400	Bad Request	–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- 422	Unprocessable Entity	–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- 500	Internal Error	–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
#### –ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏:

```json
{
  "detail": [
    {
      "loc": ["body", "user_id"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

## üåê –§—Ä–æ–Ω—Ç–µ–Ω–¥
### **–û–ø–∏—Å–∞–Ω–∏–µ**
–û–ø–∏—Å–∞–Ω–∏–µ
–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –º–æ–¥–µ–ª–∏. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫–∏, —Ç–∞–±–ª–∏—Ü—ã –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤.

### **–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**  
```
- ReactJS  # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è UI
- Axios  # HTTP-–∑–∞–ø—Ä–æ—Å—ã –∫ –±—ç–∫–µ–Ω–¥—É
```


## –ó–∞–ø—É—Å–∫
–ó–∞–ø—É—Å–∫ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ **Docker Compose**.

### **[–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–ª—è —Å–±–æ—Ä–∫–∏](https://github.com/kusneid/HackatonWB/tree/api)**

### –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ **Docker** –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```shell
docker-compose build --no-cache && docker-compose up -d
```

### –ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω **[–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å](http://localhost:3000)**

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏
–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–±–æ—Ä–∫–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —á—Ç–æ–±—ã –ø–æ—Ä—Ç—ã 8000 –∏ 3000 –±—ã–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã.
